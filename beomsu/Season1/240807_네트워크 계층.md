## 네트워크 계층 : IP 프로토콜

IP의 대표적인 기능  : **Forwarding**와 **Routing**

1. **Forwarding** :  패킷을 목적지로 전달하는 실제 동작을 담당한다. 즉, 패킷이 들어왔을 때 이를 어떤 경로로 보낼지를 결정하여 전송하는 과정
2. **Routing** : 최적의 경로를 결정하고 이를 라우팅 테이블에 반영하는 과정

**IPv4와 IPv6의 차이**

IP 주소 = 네트워크에서 장치를 식별하는 주소

IPv4는 32비트 주소 체계를 사용하여 약 43억 개의 주소를 제공

IPv6는 128비트 주소 체계를 사용하여 거의 무제한의 주소를 제공 > IPv6는 주소 부족 문제를 해결하기 위해 개발되었습니다.

## CIDR (Classless Inter-Domain Routing)

IP 주소를 할당하고 라우팅하는 방식을 유연하게 변경한 것으로, 고정된 클래스(A, B, C 클래스) 대신에 가변 길이 서브넷 마스크(VLSM, Variable Length Subnet Mask)를 사용

>여러 개의 연속된 IP 주소 블록을 하나의 엔트리로 집계하여 라우팅 테이블의 크기를 줄인다.

- 서브넷팅 방식의  장점

1) IP 주소를 필요한 만큼만 할당할 수 있으므로 주소 낭비 줄여 효율성이 높아진다.

2) 네트워크를 더 작은 서브넷으로 나누면, 트래픽을 격리할 수 있어 보안을 강화할 수 있다.

3) 다양한 크기의 네트워크 요구에도 적용 가능

## DHCP (Dynamic Host Configuration Protocol)

네트워크 장치에 IP 주소와 기타 네트워크 설정을 자동으로 할당하는 프로토콜

(IP 주소를 직접 입력하지 않아도 자동으로 할당하는 걸 **동적 할당**이라고 한다. <> 정적 할당(수동))

- 네트워크 관리자나 사용자들이 각 장치에 수동으로 IP 주소를 설정할 필요가 없어져 네트워크 설정을 단순화할 수 있다.

개념 : DHCP는 네트워크 상의 각 장치가 자동으로 IP 주소, 서브넷 마스크, 게이트웨이, DNS 서버 등의 네트워크 설정을 받을 수 있도록 돕는다.

- 이는 네트워크 관리의 효율성을 높이고 IP 주소 충돌을 방지한다.

- 과정
    
    **1. DHCP Discover**
    
    - **클라이언트**가 ****네트워크에 처음 연결되면, DHCP 서버를 찾기 위해 브로드캐스트 메시지(DHCP Discover)를 보낸다. 이 메시지는 "나는 네트워크에 연결되고 싶어. DHCP 서버 누구 있나요?"라는 의미.
    
    **2. DHCP Offer**
    
    - **DHCP 서버**는 이 브로드캐스트 메시지를 받고, 클라이언트에게 사용 가능한 IP 주소와 기타 네트워크 설정을 제공하는 DHCP Offer 메시지를 보낸다. 이 메시지에는 "나는 DHCP 서버야. 너에게 이 IP 주소를 제공할 수 있어"라는 의미가 포함된다.
    
    **3. DHCP Request**
    
    - **클라이언트**는 받은 DHCP Offer 중 하나를 선택하고, 해당 DHCP 서버에게 DHCP Request 메시지를 보낸다. 이 메시지는 "너의 제안을 받아들일게. 그 IP 주소를 나에게 할당해줘"라는 의미이다.
    
    **4. DHCP Acknowledge**
    
    - **DHCP 서버**는 클라이언트의 요청을 받아들이고, 클라이언트에게 IP 주소를 할당했다는 DHCP Acknowledge 메시지를 보낸다. 이 메시지는 "너의 요청을 받아들였어. 이 IP 주소를 사용해도 돼"라는 의미이다. 이제 클라이언트는 네트워크 설정을 완료하고 네트워크를 사용할 수 있다.

## NAT (Network Address Translation)

네트워크 주소 변환 기술로, 내부 네트워크의 프라이빗 IP 주소를 공용 IP 주소로 변환하여 인터넷에 접속할 수 있게 해주는 기술

> NAT는 주로 IPv4 주소의 부족 문제를 해결하기 위해 사용! + 보안 강화의 이점까지!

동작 원리 : 내부 네트워크에서 나가는 패킷의 IP 주소를 공용 IP 주소로 변환하고, 외부에서 들어오는 패킷의 IP 주소를 다시 내부 네트워크의 IP 주소로 변환

그럼에도, IPv6가 더 명확한 해결책이다. > 충분한 주소공간을 가지고 end-to-end 연결성을 유지기 때문이다.

## IP Framentation & Reassembly

**IP Framentation**  = 네트워크를 통해 전송될 때 각 링크의 MTU를 초과하는 경우, 데이터그램을 분할하는 과정

*MTU = Maximum Transmission Unit : 한 번에 전송 가능한 IP 패킷의 최대 크기

**IP Reassembly** = 분할된 조각들이 목적지에 도착하면 원본 데이터그램으로 재조립되는 과정

큰 데이터를 효율적으로 전송가능하지만, 오버헤드 증가하고 손실 가능성이 발생하는 문제점도 있다. 

## ICMP (Internet Control Message Protocol)

네트워크 장비 간에 오류 메시지와 제어 메시지를 교환하기 위해 사용 > ICMP 메시지는 IP 패킷 내부에 캡슐화되어 전송

Echo Request/Reply, Destination Unreachable, Time Exceeded, Redirect, Parameter Problem 등

예시) 

- **오류 보고**: 네트워크 장치 간의 통신 오류를 감지하고 이를 송신자에게 보고

예를 들어, 패킷이 목적지에 도달할 수 없으면 "Destination Unreachable" 메시지를 보낸다.

- **진단**: 네트워크 상태를 진단하고 문제를 해결하는 데 사용된다. 대표적인 예로 `ping`과 `traceroute` 명령어가 있다. `ping`은 Echo Request와 Echo Reply 메시지를 사용하여 네트워크 연결 상태를 확인하고, `traceroute`는 Time Exceeded 메시지를 사용하여 경로를 추적한다.

## TTL(time to Live

=  IP 패킷이 네트워크를 통해 전달될 수 있는 최대 홉 수를 나타내는 필드

각 라우터를 지날 때마다 1씩 감소하며, TTL이 0이 되면 패킷은 폐기 > 무한 루프를 방지하기 위해 필요!

TTL은 송신 측에서 설정하며(대부분의 운영체제는 64로 설정) TTL 값이 너무 작게 설정되면, 패킷이 목적지에 도달하기 전에 TTL이 0이 되어 폐기될 수 있다.

# 복습 질문
- 1.  TCP의 혼잡 제어 3단계인 Slow Start, Additive Increase, Multiplicative Decrease를 설명해주세요.
    
    > Slow Start: 연결 초기에는 전송 속도를 매우 낮게 시작하여, 패킷을 지수적으로 증가시키면서 네트워크의 최대 처리량을 탐색합니다. 예를 들어, 처음에는 1개의 패킷을 보내고, 다음에는 2개, 4개, 8개… 이렇게 증가합니다.Additive Increase: 혼잡이 없다고 판단되면, 전송 속도를 선형적으로 증가시킵니다. 예를 들어, cwnd가 10KB로 설정된 후, 매 RTT마다 1KB씩 증가합니다.Multiplicative Decrease: 혼잡이 감지되면, 전송 속도를 급격히 줄입니다. 예를 들어, 패킷 손실이 발생하면 cwnd를 절반으로 줄이고, 다시 시작합니다.
    > 
- 2.Pipelined 프로토콜과 Go-Back-N, Selective Repeat의 차이점을 설명해주세요.
    
    > Pipelined Protocols: 여러 패킷을 동시에 전송하여 네트워크 효율성을 높이는 프로토콜입니다. 패킷이 전송되는 동안 수신 확인을 기다리지 않고, 여러 패킷을 병렬로 보내면서 네트워크의 대역폭을 효율적으로 사용합니다.
    > 
    > 
    > **Go-Back-N:** 송신자는 N개의 패킷을 연속적으로 전송할 수 있으며, 패킷 손실이 발생하면 손실된 패킷 이후의 모든 패킷을 다시 전송합니다. 이 방식은 구현이 간단하지만 대역폭을 낭비할 수 있습니다.
    > 
    > **Selective Repeat:** 손실된 패킷만 다시 전송합니다. 수신자는 손실된 패킷만 요청하고, 나머지 패킷은 유지하여 효율성을 높입니다. 이는 Go-Back-N보다 더 효율적이지만 구현이 복잡합니다.
    > 
- 3.UDP와 TCP의 개념에 대해 설명해보세요.
    - **UDP (User Datagram Protocol)**:
        - **비연결 지향적**: 연결 설정 없이 데이터를 전송합니다.
        - **신뢰성 없음**: 오류 검출 및 수정 기능이 없으며, 패킷 손실 시 재전송하지 않습니다.
        - **빠름**: 헤더 크기가 작고, 연결 설정과 유지 관리가 필요 없기 때문에 전송 속도가 빠릅니다.
        - **사용 예**: 실시간 스트리밍, 온라인 게임, VoIP.
    - **TCP (Transmission Control Protocol)**:
        - **연결 지향적**: 데이터 전송 전에 연결을 설정합니다.
        - **신뢰성 있음**: 오류 검출, 순서 보장, 흐름 제어, 혼잡 제어 기능을 제공합니다.
        - **느림**: 연결 설정과 관리, 오류 복구 메커니즘 때문에 상대적으로 전송 속도가 느립니다.
        - **사용 예**: 웹 브라우징, 파일 전송, 이메일.
- 4.  소켓의 개념에 대해 설명해보세요
    
    네트워크 프로그래밍에서 프로세스 간 통신의 종단점을 정의하는 인터페이스입니다. IP 주소와 포트 번호의 조합으로 구성되며, 클라이언트와 서버가 데이터를 주고받기 위해 사용하는 소켓을 통해 통신합니다. 소켓을 사용하면 애플리케이션이 네트워크와 쉽게 상호작용할 수 있습니다.
    
- 5. Multiplexing과 Demultiplexing 개념에 대해 설명해보세요
    - **Multiplexing**: 여러 애플리케이션 또는 데이터 흐름이 하나의 물리적 네트워크 연결을 공유할 수 있게 하는 기술입니다. 송신 측에서는 여러 데이터 스트림을 하나의 통합된 데이터 스트림으로 결합합니다.
    - **Demultiplexing**: 수신 측에서 통합된 데이터 스트림을 원래의 개별 데이터 스트림으로 분리하는 과정입니다. 수신된 데이터를 올바른 애플리케이션으로 전달하기 위해 포트 번호와 같은 식별자를 사용합니다.
